name: "Verification Check"

on:
  pull_request:
    types: [opened, edited, reopened, synchronize]

jobs:
  check-tested-locally:
    runs-on: ubuntu-latest
    steps:
      - name: Check for "Tested Locally" checkbox
        uses: actions/github-script@v6
        with:
          script: |
            const body = context.payload.pull_request.body || "";
            const title = context.payload.pull_request.title;

            const enforcedTitlePattern = /^(feature)(\(.*\))?:/i;

            if (!enforcedTitlePattern.test(title)) {
              console.log("✅ Skipping check: PR title does not require manual verification.");
              return;
            }

            const pattern = /-\s*\[x\]\s*I have tested this code locally/i;
            const header = /-\s*\[x\]\s*Verification/i;

            if (!header.test(body)) {
              console.log("✅ Verification skipped.");
            } else if (!pattern.test(body)) {
              core.setFailed("❌ You must check the box 'I have tested this code locally' in the PR description to merge.");
            } else {
              console.log("✅ Verification confirmed.");
            }
